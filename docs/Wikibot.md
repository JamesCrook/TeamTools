## Wikibot





### upload.py

Pywikibot only needs a little adaptation for our needs.  The most useful script is upload.py to upload multiple pngs to our wiki.  Our version, upload2.py is lobotomized as follows, removing tests for replacementL  

```python
  if potential_file_page.canBeEdited():
     if pywikibot.input_yn(u"File with name %s already exists. "
          "Would you like to change the name? "
          "(Otherwise file will be overwritten.)"
          % filename, default=True,
          automatic_quit=False):
      continue
  else:
      break
  else:
```


These lines:

```python
    keepFilename = False
    useFilename = None
    verifyDescription = True
    aborts = set()
    ignorewarn = set()
```

Become:

```python
    keepFilename = True
    useFilename = None
    verifyDescription = False
    aborts = set()
    ignorewarn = True
```

We'll reuse the same filename, we don't check the description and we ignore warnings.

Use as follows:

```python
python pwb.py upload2 path-to-directory-containing-images'description of the change'
```


### general configuration

user-cfg.py contains user and wiki identification:

```python
# -*- coding: utf-8  -*-
from __future__ import unicode_literals
family = 'man'
mylang = 'en'
usernames['man']['en'] = u'JamesCrook'
password_file = "bot719pass.txt"
```
 
Where the bot719pass.txt file contains:

```python
 ("en","man","JamesCrook","bot719@thepasswordstring")
```
 
The families/man_family.py file is autogenerated, using a script.  The crucial part is shown below, which associates the identifier 'man' with our manual.

```python
    def __init__(self):
        family.Family.__init__(self)
        self.name = 'man'
        self.langs = {
            'en': 'alphamanual.audacityteam.org',
        }
```        


### user-fixes.py

We use 'fixes' to do search and replace on files in wiki.  We can do multiple find/replace in one pass through the files.  The replacements is an array of regexps, though here we just have one regexp.

```python
fixes['butt'] = {
    'regex': True,
    'msg': {
        '_default': u'Template for \'the buttons\'',
    },
    'replacements': [
        (r'==The buttons(.*?)the audio unchanged.', r'==The buttons==\n{{effectbuttons|name={{subst:PAGENAME}}}}'),
    ]
}

``` 