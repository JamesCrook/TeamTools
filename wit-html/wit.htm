<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>What is That?</title>
    <style type="text/css">

        #gui {
            display: inline-block;
            margin-left: auto;
            margin-right: auto;
            /*float:left;*/
        }

        #GuiCanvas {
            display: inline-block;
            margin-left: auto;
            margin-right: auto;
            /*float:left;*/
        }

        #scroller {
            display: inline-block;
            height: 587px;
            width: 350px;
            overflow: auto;
            /*background-color: #c2ceff;*/
            margin-left: auto;
            margin-right: auto;
        }

        #click-list {
            display: inline-block;
            margin-left: auto;
            margin-right: auto;
            /*float:left;*/
        }


    </style>
    <script src="./js/boxes.js"></script>
    <script>

        var Message = null;
        var ClickList = null;
        // @return var
        function FindBox(x, y){

            var i;
            var v;
            //console.log( "Finding x:"+x+" y:"+y);
            for( i = 1; i < image_boxes.length; i++ ){
                v = image_boxes[i];
                if( (v[0] <= x) && (v[1] <= y) && ( v[2] >= x ) &&
                        (v[3] >= y ) ){
                    v.ix = i;
                    return v;
                }
            }
            v = image_boxes[0];
            v.ix = 0;
            return v;
        }

        var FirstClick = function(){
            alert("Hi there");
        }

        function MakeClickList(){
            if( ClickList )
                return;
            ClickList = document.getElementById("click-list");

            var text = '';
            var i;
            for( i = 1; i < image_boxes.length; i++ ){
                text = text + ' <span style="white-space:nowrap">' +
                        '<span style="color: #1148f7; font-size:1.5em;' +
                        'font-weight:bold">' + i + '</span> <b>' +
                        '<a href = "/man/Transport_Toolbar "' +
                        'title = "Transport Toolbar">' +
                        '<span title = "Transport Toolbar has buttons for ' +
                        'controlling playback and recording and for moving to ' +
                        'the project start or end" >' + image_boxes[i][4] +
                        '</span></a></b> &#160;' + '</span>';
            }
            ClickList.innerHTML = text;
        }

        var GuiCanvas;
        var GuiImg;
        var GuiCtx;

        function GuiInit(){
            GuiImg = document.getElementById("gui");
            GuiCanvas = document.getElementById("GuiCanvas");
            GuiCanvas.width = GuiImg.width;
            GuiCanvas.height = GuiImg.height;
            GuiCtx = GuiCanvas.getContext("2d");


            GuiCtx.drawImage( GuiImg, 0, 0 );

            GuiImg.style.display = 'none';
            GuiCanvas.style.display = 'inline';
        }

        window.onload = function(){
            MakeClickList();
            GuiInit();
        }

        function RefreshImage( box ){
            GuiCtx.drawImage( GuiImg, 0, 0 );
            if( box.ix < 1 )
                return;
            GuiCtx.globalAlpha = 0.6;
            GuiCtx.fillStyle='black';
            GuiCtx.fillRect( 0, 0, GuiCanvas.width, GuiCanvas.height );
            GuiCtx.globalAlpha = 1.0;
            var x= box[0];
            var y= box[1];
            var w= box[2]-box[0];
            var h= box[3]-box[1]
            GuiCtx.drawImage( GuiImg, x,y,w,h,x,y,w,h );
            GuiCtx.beginPath();
            GuiCtx.rect( x,y,w,h );
            GuiCtx.stroke();
        }


        var lastIx = -1;

        function ImageClick(event, isclick){
            if( !Message )
                Message = document.getElementById("message");
            //img.src = "./images/da-coloured.png";
            //var x1 = event.pageX - img.offsetLeft;
            //var y1 = event.pageY - img.offsetTop;
            var XX = event.offsetX;
            var YY = event.offsetY;

            var box = FindBox(XX, YY);
            if( isclick ){
                console.log(box);
                console.log("x:" + XX + " y:" + YY + " Box:" + box.ix);
            }
            if( box.ix != lastIx ){
                lastIx = box.ix;
                Message.innerHTML = box[4];
                RefreshImage(box);
            }
            //alert( "X:"+ XX + " Y:"+ YY + " ix:"+ixx);
        }


    </script>
</head>
<body>

<div style="width:100%; text-align:center">
    <h1>What is That?</h1>
    <h2>Click on the diagram to find out more</h2>
    <div style="width:100%; text-align:center">

        <canvas id="GuiCanvas" width="100" height="100" style="display: none;"
                OnClick="ImageClick(event,true);"
                OnMouseMove="ImageClick(event,false)"
                alt="Clickable Canvas"></canvas>
        <img id="gui" src="./images/blank-links.png"
             OnClick="ImageClick(event,true);"
             OnMouseMove="ImageClick(event,false);" alt="Audacity">
        <iframe id="scroller" src="./scroller-contents/top_menu.html"
                seamless></iframe>
        <div id="message">some message</div>
        <div id="click-list" style="width:1000px;">The ClickList</div>
    </div>
</div>
</body>
</html>